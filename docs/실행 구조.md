┌─────────────────────────────────────────────────────────────────┐
│                    MOBY Edge 시스템 아키텍처                      │
└─────────────────────────────────────────────────────────────────┘

1️⃣  motor_PdM.py (모터 제어 + IR 센서)
    ├─ GPIO 제어: AIN1, AIN2, PWMA, STBY
    ├─ 모터 구동: PWM 100Hz, 68% Duty
    ├─ IR 센서: GPIO 17에서 회전 감지
    ├─ RUL 예측: 사이클 시간 기반 고장 예측
    └─ MQTT 발행: factory/conveyor/ir (건강 상태)

2️⃣  sensor_final.py (다중 센서 수집 + 윈도우 생성)
    ├─ DHT11: 습도 (1Hz)
    ├─ SEN0209 진동: ADS1115 A0 (16Hz)
    ├─ SZH-EK087 음성: ADS1115 A1 (16Hz)
    ├─ MPU6050 가속도/회전: I2C (16Hz)
    │  └─ 버퍼 관리: WINDOW_SIZE=2.5s
    │     데이터가 차면 WindowMessage 생성
    ├─ BMP180 기압: I2C (16Hz)
    ├─ MQTT 발행: 원본 센서 데이터 + 윈도우 메시지
    └─ MQTT 구독: 추론 결과 수신 (inference_results)

3️⃣  inference_worker.py (MQTT 수신 → 모델 추론 → 결과 발행)
    ├─ MQTT 구독: factory/window/accel_gyro/#
    ├─ 모델 로드:
    │  ├─ Isolation Forest (joblib, scaler)
    │  └─ MLP Classifier (ONNX, pickle scaler)
    ├─ 특성 추출: legacy 방식 (파이프라인 미적용)
    ├─ 병렬 추론:
    │  ├─ IF: score_samples() → iforest_score
    │  └─ MLP: predict_proba_raw() → mlp_s1_prob_* + mlp_s2_prob_*
    └─ MQTT 발행: factory/result/* (모델별 이상 점수)

## 데이터 흐름
┌──────────────────┐
│   motor_PdM.py   │ ──MQTT──→ factory/conveyor/ir
│  (모터 + IR)     │  (회전 주기, 고장 예측)
└──────────────────┘
         │
         │ (GPIO 제어)
         │
    ┌────▼──────────────────┐
    │  Motor 회전           │
    │  (PWM 100Hz, 68%)     │
    └───────────────────────┘


┌──────────────────┐
│ sensor_final.py  │
│ (멀티 센서)      │
├──────────────────┤
│ DHT11            │
│ 진동 (ADS1115)   │
│ 음성 (ADS1115)   │
│ MPU6050 (I2C)    │
│ BMP180 (I2C)     │ ──MQTT──→ factory/sensor/*
└──────────────────┘                (원본 데이터)
         │
         │
    ┌────▼────────────────────┐
    │ 윈도우 버퍼 관리         │
    │ (2.5초 단위)           │
    │ 일반적인 시계렬 신호 모음 │
    └────┬────────────────────┘
         │
         │ 버퍼 꽉 찼을 때
         │ WindowMessage 발행
         │
      MQTT
         │
         ▼
┌──────────────────────────────┐
│ inference_worker.py          │
│ (MQTT 수신 → 추론 → 발행)     │
├──────────────────────────────┤
│ 수신: WindowMessage          │
│      (accel_x/y/z 등)       │
│                              │
│ 처리:                        │
│ 1. 특성 추출 (11개)         │
│ 2. Isolation Forest          │
│    → iforest_score          │
│ 3. MLP Classifier (ONNX)     │
│    → mlp_s1_prob_*          │
│    → mlp_s2_prob_*          │
│ 4. 결과 발행                 │
└──────────────────────────────┘
         │
         │ MQTT
         ▼
┌──────────────────────────────┐
│ sensor_final.py (구독)        │
│ inference_results 업데이트    │
│ 터미널 출력: 이상 점수 표시   │
└──────────────────────────────┘